clear all;close all;clc;

K_num = 6;
rou = 0.1;
J = 36;
P = 1/36;
gamma = 10^(-20 / 10) / 1000;
epsilon = 10^(-57 / 10 );

as_ele_Tx = [0.934218995805062 + 0.356699968989319i
0.934218995805062 + 0.356699968989319i
0.934218995805062 + 0.356699968989319i
0.934218995805062 + 0.356699968989319i
0.934218995805062 + 0.356699968989319i
0.934218995805062 + 0.356699968989319i
-0.848114519835571 + 0.529812949298221i
-0.848114519835571 + 0.529812949298221i
-0.848114519835571 + 0.529812949298221i
-0.848114519835571 + 0.529812949298221i
-0.848114519835571 + 0.529812949298221i
-0.848114519835571 + 0.529812949298221i
0.0891845665475509 - 0.996015116898195i
0.0891845665475509 - 0.996015116898195i
0.0891845665475509 - 0.996015116898195i
0.0891845665475509 - 0.996015116898195i
0.0891845665475509 - 0.996015116898195i
0.0891845665475509 - 0.996015116898195i
0.740497209935804 + 0.672059433441187i
0.740497209935804 + 0.672059433441187i
0.740497209935804 + 0.672059433441187i
0.740497209935804 + 0.672059433441187i
0.740497209935804 + 0.672059433441187i
0.740497209935804 + 0.672059433441187i
-0.982728380309160 + 0.185053858470813i
-0.982728380309160 + 0.185053858470813i
-0.982728380309160 + 0.185053858470813i
-0.982728380309160 + 0.185053858470813i
-0.982728380309160 + 0.185053858470813i
-0.982728380309160 + 0.185053858470813i
0.445342322004285 - 0.895360383438888i
0.445342322004285 - 0.895360383438888i
0.445342322004285 - 0.895360383438888i
0.445342322004285 - 0.895360383438888i
0.445342322004285 - 0.895360383438888i
0.445342322004285 - 0.895360383438888i];

Hm = [0.00364260800000000 + 0.00150379800000000i	0.00225635200000000 - 0.00107919200000000i	0.000282878700000000 - 0.00137477700000000i	-0.000468563000000000 - 0.000511359800000000i	-0.000484533200000000 + 0.000236321400000000i	8.19933400000000e-05 + 0.000136496900000000i	-0.00717287500000000 - 0.00219247800000000i	-0.00359895100000000 + 0.00205271400000000i	-0.000265417100000000 + 0.00200448600000000i	0.000872365100000000 + 0.000791984000000000i	0.000665827800000000 - 0.000640995600000000i	-0.000318967100000000 - 0.000385946700000000i	0.0141082400000000 + 0.00283914000000000i	0.00526788900000000 - 0.00339907900000000i	0.000739604200000000 - 0.00302681400000000i	-0.00244806700000000 - 0.00122470300000000i	-0.000248050200000000 + 0.00211988800000000i	0.00121491000000000 - 0.000264584100000000i	-0.0259726800000000 - 0.00312138100000000i	-0.00874467600000000 + 0.00356050800000000i	0.000173563600000000 + 0.00764228400000000i	0.00588517100000000 - 0.00269312300000000i	-0.00360189300000000 - 0.00204636100000000i	0.000216860900000000 + 0.00201329300000000i	0.0460344500000000 + 0.0114869100000000i	0.0177188600000000 - 0.0104541900000000i	-0.0140808600000000 - 0.00747839800000000i	0.00139051400000000 + 0.0104116200000000i	0.00310979200000000 - 0.00395207600000000i	-0.00206735900000000 + 0.000406579300000000i	-0.0923567800000000 - 0.0285803300000000i	0.00829458700000000 + 0.0127615200000000i	0.0137567700000000 - 0.00919952000000000i	-0.00879294900000000 - 0.00407963700000000i	0.00231483200000000 + 0.00328226300000000i	-0.000524192200000000 - 0.00189450700000000i
0.00196750500000000 - 0.00122703000000000i	0.000443850700000000 - 0.000106160500000000i	0.00101659600000000 + 0.000495489800000000i	0.00106078800000000 - 0.000393351600000000i	-0.000171070700000000 - 0.00118374300000000i	-0.000333794300000000 + 0.000206129300000000i	-0.00289549400000000 + 0.00229140000000000i	-0.000890466900000000 - 0.00100889400000000i	-0.00259096300000000 - 0.00116274700000000i	-0.00207892800000000 + 0.00149774100000000i	0.00117056800000000 + 0.00158450000000000i	0.000551496200000000 - 0.000441811000000000i	0.00377707700000000 - 0.00377415500000000i	0.00289919800000000 + 0.00495399500000000i	0.00657273200000000 + 0.00163654300000000i	0.00279384900000000 - 0.00425464300000000i	-0.00328015800000000 - 0.00136281900000000i	-0.000468123200000000 + 0.00178529100000000i	-0.00540663700000000 + 0.00328739500000000i	-0.0108042900000000 - 0.0139455200000000i	-0.0147349100000000 - 0.000696758000000000i	-2.79436900000000e-05 + 0.0106574000000000i	0.00647044400000000 - 0.00349046500000000i	-0.00315443900000000 - 0.00227519200000000i	0.0133852600000000 - 0.00651255100000000i	0.0358952800000000 + 0.0360712400000000i	0.0265995800000000 - 0.0132940000000000i	-0.0172008600000000 - 0.00915987800000000i	0.00190364900000000 + 0.0113389700000000i	0.00349223400000000 - 0.00360015500000000i	0.00788561700000000 + 0.00796576800000000i	-0.0994357900000000 - 0.0462843300000000i	0.00555236900000000 + 0.0204992500000000i	0.0164968400000000 - 0.0107441200000000i	-0.00970411800000000 - 0.00381031700000000i	0.00225073400000000 + 0.00355730300000000i
8.09910600000000e-05 - 0.00123590000000000i	0.00105392400000000 + 0.000475853300000000i	0.00152447100000000 + 0.000460218400000000i	0.00106437000000000 - 0.000400855800000000i	0.00108955700000000 - 0.000426450400000000i	-0.000453469700000000 - 0.000324559300000000i	3.44129100000000e-05 + 0.00156289400000000i	-0.00269591200000000 - 0.00111550000000000i	-0.00298071300000000 - 0.000703778000000000i	-0.00189252400000000 - 0.000214561400000000i	-0.00204182900000000 + 0.00158293200000000i	0.000613987300000000 + 0.000520801300000000i	0.000367458500000000 - 0.00189128600000000i	0.00678314700000000 + 0.00147478700000000i	0.00495937100000000 + 0.00230493000000000i	0.00520970100000000 + 0.00165498200000000i	0.00262848500000000 - 0.00436098100000000i	-0.00166742800000000 - 0.00114191400000000i	-0.000765997300000000 + 0.00553021200000000i	-0.0149036200000000 - 0.000286246500000000i	-0.00986280600000000 - 0.00934975400000000i	-0.0141118000000000 - 0.00218835900000000i	0.000163713600000000 + 0.0105604700000000i	0.00526053100000000 - 0.00171055000000000i	-0.0111481200000000 - 0.00723174800000000i	0.0262982700000000 - 0.0135719700000000i	0.0313661900000000 + 0.0348314000000000i	0.0277879000000000 - 0.0123466000000000i	-0.0171059700000000 - 0.00900544300000000i	0.000402681500000000 + 0.00979005900000000i	0.0133417000000000 - 0.00787425400000000i	0.00533262300000000 + 0.0205458000000000i	-0.0973891900000000 - 0.0490334900000000i	0.00429192300000000 + 0.0210471600000000i	0.0165443000000000 - 0.0106015200000000i	-0.00872039600000000 - 0.00471149200000000i
-0.000450353300000000 - 0.000327059500000000i	0.00109344300000000 - 0.000421452600000000i	0.00106886900000000 - 0.000390037200000000i	0.00152070200000000 + 0.000463319800000000i	0.00105320200000000 + 0.000481939400000000i	8.59408300000000e-05 - 0.00123509000000000i	0.000607225700000000 + 0.000520362000000000i	-0.00205843000000000 + 0.00156534300000000i	-0.00189941000000000 - 0.000231118100000000i	-0.00296943800000000 - 0.000720289500000000i	-0.00269744600000000 - 0.00111103300000000i	2.90406100000000e-05 + 0.00156069900000000i	-0.00166027600000000 - 0.00114932000000000i	0.00266334000000000 - 0.00434921500000000i	0.00522270100000000 + 0.00171310300000000i	0.00493582900000000 + 0.00231960500000000i	0.00676322100000000 + 0.00149098400000000i	0.000388581600000000 - 0.00188701900000000i	0.00530627000000000 - 0.00166506400000000i	0.000124399100000000 + 0.0105876900000000i	-0.0141041300000000 - 0.00220535700000000i	-0.00981099800000000 - 0.00949336700000000i	-0.0148262300000000 - 0.000380945400000000i	-0.000747518900000000 + 0.00551039900000000i	0.000352306300000000 + 0.00978063800000000i	-0.0169441700000000 - 0.00908249100000000i	0.0279177900000000 - 0.0122798000000000i	0.0311241100000000 + 0.0350119600000000i	0.0263449500000000 - 0.0135689000000000i	-0.0112161300000000 - 0.00721055400000000i	-0.00874386800000000 - 0.00465642900000000i	0.0165415200000000 - 0.0105206700000000i	0.00411247300000000 + 0.0209197600000000i	-0.0972910000000000 - 0.0493487000000000i	0.00566943500000000 + 0.0204740400000000i	0.0133201800000000 - 0.00773214300000000i
-0.000329295500000000 + 0.000206555700000000i	-0.000178179900000000 - 0.00117465100000000i	0.00105275200000000 - 0.000397165800000000i	0.00101465100000000 + 0.000484701300000000i	0.000442861300000000 - 0.000106832200000000i	0.00196685900000000 - 0.00123069700000000i	0.000540362200000000 - 0.000440742800000000i	0.00116844000000000 + 0.00157649600000000i	-0.00206766700000000 + 0.00150264000000000i	-0.00257860400000000 - 0.00114084100000000i	-0.000900928000000000 - 0.000999593600000000i	-0.00289304400000000 + 0.00229428100000000i	-0.000459039000000000 + 0.00178530400000000i	-0.00326924600000000 - 0.00135276400000000i	0.00278190000000000 - 0.00425557500000000i	0.00651753500000000 + 0.00158694400000000i	0.00292811200000000 + 0.00492791300000000i	0.00379160500000000 - 0.00375462700000000i	-0.00317659600000000 - 0.00228666700000000i	0.00645572700000000 - 0.00352988800000000i	4.07338000000000e-05 + 0.0106105100000000i	-0.0146879100000000 - 0.000725253600000000i	-0.0107999000000000 - 0.0138885400000000i	-0.00542584000000000 + 0.00331607300000000i	0.00346007000000000 - 0.00360344700000000i	0.00191634100000000 + 0.0112550500000000i	-0.0173022300000000 - 0.00901287300000000i	0.0265125300000000 - 0.0133473600000000i	0.0360390900000000 + 0.0361159800000000i	0.0133986600000000 - 0.00666567400000000i	0.00226890400000000 + 0.00349346100000000i	-0.00964860700000000 - 0.00374169000000000i	0.0163935300000000 - 0.0108209200000000i	0.00578319500000000 + 0.0204518200000000i	-0.0996576900000000 - 0.0458514400000000i	0.00771696200000000 + 0.00777214400000000i
8.18872600000000e-05 + 0.000135368500000000i	-0.000480989800000000 + 0.000238422800000000i	-0.000469533500000000 - 0.000506054000000000i	0.000263337400000000 - 0.00136726300000000i	0.00223634700000000 - 0.00109464000000000i	0.00365048700000000 + 0.00147145100000000i	-0.000317649900000000 - 0.000381312300000000i	0.000665217100000000 - 0.000640230900000000i	0.000876091800000000 + 0.000786793400000000i	-0.000245863300000000 + 0.00199107200000000i	-0.00355626700000000 + 0.00209295100000000i	-0.00717487200000000 - 0.00212604400000000i	0.00121561900000000 - 0.000267617900000000i	-0.000249253300000000 + 0.00211723600000000i	-0.00245687400000000 - 0.00122295400000000i	0.000711962100000000 - 0.00299733400000000i	0.00522563700000000 - 0.00344408200000000i	0.0140454600000000 + 0.00273533500000000i	0.000214023000000000 + 0.00203103700000000i	-0.00361385400000000 - 0.00204200000000000i	0.00586291400000000 - 0.00271533100000000i	0.000160535000000000 + 0.00764042400000000i	-0.00868661800000000 + 0.00358338900000000i	-0.0258776700000000 - 0.00293009400000000i	-0.00206409000000000 + 0.000408987100000000i	0.00310292900000000 - 0.00392082200000000i	0.00144658100000000 + 0.0104384900000000i	-0.0141255800000000 - 0.00751527400000000i	0.0177829100000000 - 0.0104851400000000i	0.0459658400000000 + 0.0111565600000000i	-0.000540960000000000 - 0.00188105400000000i	0.00230737300000000 + 0.00327434600000000i	-0.00878557500000000 - 0.00408054000000000i	0.0137575700000000 - 0.00918893600000000i	0.00816613700000000 + 0.0127397400000000i	-0.0916730400000000 - 0.0279794300000000i];

cvx_begin 
variable F(J,J) hermitian semidefinite
variable t(K_num,1) 
A = (as_ele_Tx * as_ele_Tx').';
% A = 1/2 *(A + A');
A1 = -1 .* A;
minimize( trace(A1 * F) )
subject to
for i = 1:(K_num)
C_i = epsilon .* diag(ones(J,1));
d_i = sqrt(chi2inv(1 - rou, 2 * J) ./ 2);

[-1 .* sqrt(C_i) * F * sqrt(C_i) + t(i) .* diag(ones(J,1))   (-1 .* sqrt(C_i) * F * Hm(i,:)'); ...
    (-1 .* sqrt(C_i) * F * Hm(i,:)')'   gamma/P - Hm(i,:) * F * Hm(i,:)' - t(i) * d_i^2] == hermitian_semidefinite( J + 1 );

t(i) >= 0;
end

diag(F) == 1;
cvx_end
